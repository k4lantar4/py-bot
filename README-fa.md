# سیستم مدیریت اکانت‌های V2Ray

یک ربات تلگرام و داشبورد وب جامع برای مدیریت اکانت‌های V2Ray، با قابلیت اتصال به چندین پنل 3x-UI. ساخته شده با Python، Django و React.

## ویژگی‌ها

- 🤖 **ربات تلگرام**
  - فروش و مدیریت اکانت‌های V2Ray
  - پرداخت کارت به کارت و زرین‌پال
  - پشتیبانی از چند زبان (فارسی/انگلیسی)
  - اعلان‌های لحظه‌ای
  - مدیریت کاربران و پشتیبانی

- 🌐 **داشبورد وب**
  - رابط کاربری مدرن و واکنش‌گرا با تم تاریک
  - پشتیبانی از RTL برای زبان فارسی
  - پنل ادمین برای مدیریت سیستم
  - داشبورد کاربری برای مدیریت اکانت‌ها
  - نظارت بر ترافیک در لحظه

- 🔄 **اتصال به پنل 3x-UI**
  - پشتیبانی از چندین پنل
  - همگام‌سازی لحظه‌ای اکانت‌ها
  - نظارت بر ترافیک
  - ایجاد خودکار اکانت
  - مدیریت خطاها

- 💳 **سیستم پرداخت**
  - پردازش پرداخت کارت به کارت
  - اتصال به درگاه زرین‌پال
  - سیستم کیف پول
  - تاریخچه تراکنش‌ها
  - تأیید پرداخت

## پیش‌نیازها

- اوبونتو 22.04 LTS
- Docker و Docker Compose
- دامنه (برای SSL)
- توکن ربات تلگرام
- اطلاعات اتصال به پنل 3x-UI

## نصب سریع

1. دریافت کد:
   ```bash
   git clone https://github.com/k4lantar4/py-bot.git
   cd py-bot
   ```

2. اجرای اسکریپت نصب:
   ```bash
   sudo chmod +x install.sh
   sudo ./install.sh
   ```

3. تنظیمات محیط:
   - ویرایش فایل `.env` با تنظیمات خود
   - تنظیم توکن ربات تلگرام
   - تنظیم اطلاعات اتصال به پنل 3x-UI
   - تنظیم جزئیات درگاه پرداخت

4. دسترسی به سیستم:
   - داشبورد وب: `https://your-domain.com`
   - پنل ادمین: `https://your-domain.com/admin`
   - ربات تلگرام: شروع با دستور `/start`

## راه‌اندازی محیط توسعه

1. ایجاد محیط مجازی:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

2. نصب وابستگی‌ها:
   ```bash
   pip install -r requirements.txt
   cd frontend && npm install
   ```

3. اجرای سرورهای توسعه:
   ```bash
   # بک‌اند
   python manage.py runserver
   
   # فرانت‌اند
   cd frontend && npm start
   ```

## استقرار با Docker

1. ساخت و اجرای کانتینرها:
   ```bash
   docker compose build
   docker compose up -d
   ```

2. مشاهده لاگ‌ها:
   ```bash
   docker compose logs -f
   ```

3. توقف سرویس‌ها:
   ```bash
   docker compose down
   ```

## ساختار پروژه

```
v2ray-bot/
├── backend/           # بک‌اند جنگو
├── frontend/         # فرانت‌اند ری‌اکت
├── bot/             # ربات تلگرام
├── nginx/           # تنظیمات انجین‌اکس
├── docs/            # مستندات
├── scripts/         # اسکریپت‌های کمکی
└── docker/          # تنظیمات داکر
```

## مشارکت در توسعه

1. فورک کردن مخزن
2. ایجاد شاخه جدید
3. ثبت تغییرات
4. ارسال به شاخه
5. ایجاد Pull Request

## مجوز

این پروژه تحت مجوز MIT منتشر شده است - برای جزئیات بیشتر به فایل [LICENSE](LICENSE) مراجعه کنید.

## پشتیبانی

برای دریافت پشتیبانی:
1. مطالعه [مستندات](docs/)
2. ثبت issue جدید
3. ارتباط از طریق تلگرام: @your_support_username

## قدردانی

- [3x-UI](https://github.com/MHSanaei/3x-ui) برای پنل مدیریت
- [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) برای فریم‌ورک ربات
- [Django](https://www.djangoproject.com/) برای فریم‌ورک بک‌اند
- [React](https://reactjs.org/) برای فریم‌ورک فرانت‌اند

## خلاصه تغییرات و بهینه‌سازی‌ها

در نسخه نهایی این پروژه، اقدامات زیر برای بهبود کیفیت و کارایی سیستم انجام شده است:

### مستندسازی
- ایجاد راهنمای کاربری کامل به زبان فارسی برای کاربران غیر فنی
- مستندسازی API برای توسعه‌دهندگان
- بهبود راهنمای نصب و راه‌اندازی سیستم
- اضافه کردن راهنمای عیب‌یابی مشکلات رایج

### بهینه‌سازی کد
- ساختاربندی منظم فایل‌ها و پوشه‌ها
- حذف کدهای تکراری و بلااستفاده
- اصلاح خطاهای موجود در سیستم
- بهبود مدیریت خطا و پیام‌های خطا

### امنیت
- بررسی و بهبود امنیت اطلاعات حساس
- اصلاح تنظیمات `.gitignore` برای جلوگیری از انتشار اطلاعات محرمانه
- پیاده‌سازی HTTPS برای ارتباطات امن
- بهبود سیستم احراز هویت و کنترل دسترسی

### بهبود نصب و راه‌اندازی
- بهبود اسکریپت نصب خودکار
- بهینه‌سازی تنظیمات Docker برای استقرار ساده‌تر
- اضافه کردن چک‌های سلامت سیستم
- بهبود مدیریت متغیرهای محیطی

برای اطلاعات بیشتر درباره نحوه استفاده از سیستم، به بخش [راهنمای کاربری](docs/user_guide_fa.md) مراجعه کنید.

## اجرای محلی (۱۴۰۲/۱۲/۲۳)

### فرآیند راه‌اندازی
1. بررسی ساختار و فایل‌های پروژه
2. ساخت کانتینرهای داکر با دستور `docker compose build`
3. راه‌اندازی کانتینرهای داکر با دستور `docker compose up -d`

### مشکلات مشاهده شده
1. بسته `django-filter` در فایل requirements.txt وجود نداشت - با اضافه کردن آن حل شد
2. تداخل بین ماژول محلی `telegram` و بسته `python-telegram-bot` - با تغییر نام ماژول به `telegrambot` حل شد
3. تداخل بین مدل‌های برنامه‌های `main` و `payments`:
   - تداخل در دسترسی معکوس برای مدل‌های User
   - تداخل در دسترسی معکوس برای مدل‌های CardPayment
   - این موارد نیاز به اضافه کردن ویژگی `related_name` به مدل‌ها دارند

### قدم‌های بعدی
1. حل تداخل‌های مدل با به‌روزرسانی تعاریف مدل‌ها
2. تکمیل مهاجرت‌های پایگاه داده
3. تست عملکرد ربات تلگرام
4. تست عملکرد داشبورد وب
5. پیکربندی ادغام با پنل 3x-UI 