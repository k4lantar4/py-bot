# سیستم مدیریت اکانت V2Ray

سیستم جامع فروش و مدیریت اکانت‌های V2Ray از طریق ربات تلگرام و داشبورد وب، با قابلیت اتصال به چندین پنل 3x-UI.

## ویژگی‌ها

### ربات تلگرام
- 🤖 رابط کاربری آسان ربات تلگرام
- 🌐 پشتیبانی از چند زبان (فارسی و انگلیسی)
- 💳 روش‌های پرداخت متنوع (کارت به کارت، زرین‌پال)
- 🔄 ایجاد و تمدید خودکار اکانت
- 📊 آمار استفاده از اکانت و اطلاع‌رسانی
- 🎫 سیستم تیکت پشتیبانی

### داشبورد وب
- 🔐 سیستم احراز هویت امن
- 🖥️ پنل مدیریت برای اکانت‌ها، پرداخت‌ها و تنظیمات
- 📱 طراحی واکنش‌گرا با پشتیبانی RTL
- 🌙 حالت تاریک با رابط کاربری مدرن (طرح رنگی خاکستری تیره، آبی تیره)
- 📈 تجزیه و تحلیل و گزارش‌دهی دقیق

### مدیریت سرور
- 🔌 ادغام با چندین پنل 3x-UI
- 🔄 همگام‌سازی داده‌های اکانت در زمان واقعی
- 📊 نظارت و مدیریت ترافیک
- 🔔 اطلاع‌رسانی خودکار برای اکانت‌های در حال انقضا
- 🛡️ نظارت بر سلامت سرور

### پردازش پرداخت
- 💳 پرداخت کارت به کارت با تأیید
- 🔄 ادغام درگاه پرداخت زرین‌پال
- 💰 سیستم کیف پول کاربر
- 🏷️ پشتیبانی از کد تخفیف
- 📜 تاریخچه تراکنش و گزارش‌دهی

## ویژگی‌های جدید

### یکپارچه‌سازی با پنل 3x-UI
- مدیریت خودکار جلسات پنل 3x-UI
- همگام‌سازی اطلاعات inbound از چندین پنل 3x-UI
- نظارت بر ترافیک مشتریان
- ایجاد و مدیریت کاربران V2Ray
- نظارت بر سلامت سرور
- پشتیبانی از پروتکل‌های VMESS، VLESS و Trojan

### داشبورد مدیریت سرور
- مشاهده وضعیت سرور در زمان واقعی
- نمایش آمار CPU و حافظه
- نمودار ترافیک
- مدیریت inbound‌ها و کلاینت‌ها

### مدیریت مشتریان
- مشاهده و فیلتر کردن مشتریان بر اساس سرور و inbound
- ایجاد مشتریان جدید
- حذف مشتریان
- نظارت بر ترافیک و تاریخ انقضا

### وظایف زمان‌بندی شده
- همگام‌سازی خودکار اطلاعات inbound‌ها
- همگام‌سازی خودکار ترافیک مشتریان
- بررسی سلامت سرور
- تمدید خودکار جلسات نزدیک به انقضا

## تکنولوژی‌های استفاده شده

- **بک‌اند**: Django با Django REST Framework
- **فرانت‌اند**: React با Material-UI
- **ربات**: python-telegram-bot (نسخه 20+)
- **پایگاه داده**: PostgreSQL
- **کش**: Redis
- **صف وظایف**: Celery
- **استقرار**: Docker، Nginx

## نصب و راه‌اندازی

### پیش‌نیازها
- Docker و Docker Compose
- Git

### شروع سریع

1. کلون کردن مخزن:
```bash
git clone https://github.com/yourusername/v2ray_bot.git
cd v2ray_bot
```

2. پیکربندی متغیرهای محیطی:
```bash
cp .env.example .env
# فایل .env را با تنظیمات خود ویرایش کنید
```

3. شروع برنامه:
```bash
./install.sh
```

## راه‌اندازی محیط توسعه

### بک‌اند
```bash
cd backend
python -m venv venv
source venv/bin/activate  # در ویندوز: venv\Scripts\activate
pip install -r requirements.txt
python manage.py migrate
python manage.py runserver
```

### فرانت‌اند
```bash
cd frontend
npm install
npm start
```

### ربات
```bash
cd bot
python -m venv venv
source venv/bin/activate  # در ویندوز: venv\Scripts\activate
pip install -r requirements.txt
python main.py
```

## مستندات

مستندات کامل در پوشه [docs](./docs) موجود است.

## مجوز

این پروژه تحت مجوز MIT منتشر شده است - برای جزئیات بیشتر فایل [LICENSE](LICENSE) را ببینید.

## پشتیبانی

برای پشتیبانی، لطفاً یک issue باز کنید یا از طریق کانال‌های پشتیبانی ذکر شده در مستندات با ما تماس بگیرید.

## بروزرسانی‌های اخیر (۱۴۰۲/۱۲/۲۲)

### ۱. ارتقاء پیکربندی پایگاه داده
- مهاجرت از SQLite به PostgreSQL
- پیاده‌سازی Connection Pooling
- افزودن تنظیمات timeout برای کوئری‌ها
- پیکربندی بهینه اتصالات

### ۲. پیاده‌سازی سیستم کش
- راه‌اندازی Redis به عنوان کش اصلی
- پیکربندی کش برای نشست‌ها
- پیاده‌سازی Connection Pooling برای Redis
- تنظیم استراتژی‌های نامعتبرسازی کش

### ۳. بهبود امنیت
- پیاده‌سازی محدودیت نرخ درخواست API
- افزودن محافظت در برابر DDoS
- پیکربندی محدودیت درخواست‌ها
- راه‌اندازی لیست سیاه IP
- افزودن هدرهای امنیتی
- پیاده‌سازی احراز هویت JWT

### ۴. بهینه‌سازی عملکرد فرانت‌اند
- پیاده‌سازی تقسیم کد با React.lazy
- افزودن بارگذاری تنبل برای تمام مسیرها
- بهینه‌سازی حجم باندل با چانک‌بندی بهتر
- پیکربندی Service Worker برای پشتیبانی آفلاین
- بهینه‌سازی تصاویر و فونت‌ها
- بهبود استراتژی‌های کش

### ۵. پیاده‌سازی سیستم مانیتورینگ
- راه‌اندازی Sentry برای ردیابی خطاها
- افزودن متریک‌های Prometheus
- پیکربندی لاگ با قابلیت چرخش
- پیاده‌سازی مانیتورینگ عملکرد
- افزودن هشدارهای ایمیلی برای مشکلات حیاتی
- راه‌اندازی APM با Elastic

### ۶. بروزرسانی وابستگی‌ها
- افزودن پکیج‌های مورد نیاز برای PostgreSQL
- افزودن وابستگی‌های Redis و کش
- افزودن پکیج‌های امنیتی
- افزودن پکیج‌های مانیتورینگ
- بروزرسانی تمام پکیج‌ها به آخرین نسخه پایدار

## تست‌ها

اجرای مجموعه تست‌ها:
```bash
# تست‌های بک‌اند
cd backend
pytest

# تست‌های فرانت‌اند
cd frontend
npm test
```

## ویژگی‌های امنیتی

- 🔒 احراز هویت JWT
- 🛡️ محافظت CSRF
- 🚫 محدودیت نرخ درخواست
- 🔐 سیاست امنیت محتوا (CSP)
- 🛑 محافظت در برابر DDoS
- 📝 هدرهای امنیتی
- 🔑 اعتبارسنجی رمز عبور
- 🚦 لیست سیاه IP

## مستندات API

مستندات API در حالت توسعه در آدرس `/api/docs/` در دسترس است.

## مشارکت

1. مخزن را fork کنید
2. یک شاخه برای ویژگی خود ایجاد کنید (`git checkout -b feature/ویژگی_جدید`)
3. تغییرات خود را commit کنید (`git commit -m 'افزودن ویژگی جدید'`)
4. به شاخه push کنید (`git push origin feature/ویژگی_جدید`)
5. یک Pull Request ایجاد کنید

## مجوز

این پروژه تحت مجوز MIT منتشر شده است - برای جزئیات بیشتر فایل [LICENSE](LICENSE) را ببینید.

## پشتیبانی

برای پشتیبانی، لطفاً یک issue باز کنید یا از طریق کانال‌های پشتیبانی ذکر شده در مستندات با ما تماس بگیرید. 